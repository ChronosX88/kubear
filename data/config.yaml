---
dsl_version: 1

core:
  services:
  - random_ip
  - rq_executor
  pipelines:
  - ftp

services:
  rq_executor:
    package: lib.exeq.Executor
    service: RQExecutor
    storage: pool
    redis:
      host: "127.0.0.1"
  random_ip:
    package: lib.plugin.base.lib.IP
    service: RandomIP
    storage: ftp_source

storage:
  pool:
    package: lib.plugin.base.lib.Mongo
    service: MongoStorage
    size: 0
    db: "medved"
    coll: 'pool'
  ftp_source:
    package: lib.plugin.base.lib.Mongo
    service: MongoStorage
    size: 500
    db: "medved"
    coll: 'ftp_source'


pipelines:
  ftp:
    source: ftp_source
    steps:
    - task: ftp_scan
      priority: low
      multiple: 100
    - task: ftp_connect
      priority: normal
      if:
        steps.ftp_scan: true
    - task: ftp_list_files
      priority: high
      if:
        steps.ftp_connect: true

tasks:
  ftp_scan:
    package: lib.plugin.iscan.tasks.common
    service: MasScanTask
    ports:
    - 21
  ftp_connect:
    package: lib.plugin.iscan.tasks.ftp
    service: FTPConnectTask
    logins: data/ftp/logins.txt
    passwords: data/ftp/passwords.txt
    bruteforce: true
    timeout: 15
  ftp_list_files:
    package: lib.plugin.iscan.tasks.ftp
    service: FTPListFilesTask

logging: 
  Storage: INFO